<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="破晓晨曦的个人笔记Blog，用于记录学习感悟及前沿技术。Xaviershi的博客。"><meta name="keywords" content="博客,个人博客,Xaviershi,XS个人博客,技术博客,XS,全栈工程师,破晓晨曦"><meta name="author" content="XS,破晓晨曦"><meta name="copyright" content="Xavier"><meta name="baidu-site-verification" content="eCDWBwIWCq"><title>vue+ssr开发美团网PC版 | XS's Blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e1c52888bff53137a720a05b1ab9eaa6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-nuxt-编写美团-PC-端-vue-ssr-egg"><span class="toc-number">1.</span> <span class="toc-text">使用 nuxt 编写美团 PC 端(vue+ssr+egg)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前置"><span class="toc-number">2.</span> <span class="toc-text">前置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nuxt-安装"><span class="toc-number">2.1.</span> <span class="toc-text">nuxt 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nuxt-启动"><span class="toc-number">2.2.</span> <span class="toc-text">nuxt 启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-redis"><span class="toc-number">2.3.</span> <span class="toc-text">安装 redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nrm"><span class="toc-number">2.4.</span> <span class="toc-text">nrm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongoDB"><span class="toc-number">2.5.</span> <span class="toc-text">mongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#技巧"><span class="toc-number">2.6.</span> <span class="toc-text">技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目中遇到的问题"><span class="toc-number">3.</span> <span class="toc-text">项目中遇到的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#让-node-支持-es6-导入语法"><span class="toc-number">3.1.</span> <span class="toc-text">让 node 支持 es6 导入语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件引入-css"><span class="toc-number">3.2.</span> <span class="toc-text">组件引入 css</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#axios-封装及报错"><span class="toc-number">3.3.</span> <span class="toc-text">axios 封装及报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三方模块全局引入"><span class="toc-number">3.4.</span> <span class="toc-text">第三方模块全局引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面字体图标引入"><span class="toc-number">3.5.</span> <span class="toc-text">页面字体图标引入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面组件开发"><span class="toc-number">4.</span> <span class="toc-text">页面组件开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题"><span class="toc-number">4.1.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vuex"><span class="toc-number">4.2.</span> <span class="toc-text">vuex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nuxt-使用-vue-awesome-swiper-做轮播等设置"><span class="toc-number">4.3.</span> <span class="toc-text">Nuxt 使用 vue-awesome-swiper 做轮播等设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台业务开发"><span class="toc-number">5.</span> <span class="toc-text">后台业务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注册"><span class="toc-number">5.1.</span> <span class="toc-text">注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#登录"><span class="toc-number">5.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题-1"><span class="toc-number">5.3.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nuxt-和-eggjs-的部署"><span class="toc-number">6.</span> <span class="toc-text">Nuxt 和 eggjs 的部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署-eggjs"><span class="toc-number">6.1.</span> <span class="toc-text">部署 eggjs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#☆☆☆☆☆-这个项目思想出了问题"><span class="toc-number">8.</span> <span class="toc-text">☆☆☆☆☆ 这个项目思想出了问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nuxt-前后端分离开发-前端刷新判断用户状态-nuxt-做接口转发"><span class="toc-number">8.1.</span> <span class="toc-text">Nuxt 前后端分离开发 前端刷新判断用户状态 nuxt 做接口转发</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/dalao.jpg"></div><div class="author-info__name text-center">Xavier</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">28</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">7</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/top_img/2.jpg);"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">XS's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title-box"><div id="post-title">vue+ssr开发美团网PC版</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-26</time><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2018/12/26/vue+ssr开发美团网PC版/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2018/12/26/vue+ssr开发美团网PC版/"></span></a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2,227</span><span class="post-meta__separator">|</span><span>阅读时长: 8 分钟</span></div></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="使用-nuxt-编写美团-PC-端-vue-ssr-egg"><a href="#使用-nuxt-编写美团-PC-端-vue-ssr-egg" class="headerlink" title="使用 nuxt 编写美团 PC 端(vue+ssr+egg)"></a>使用 nuxt 编写美团 PC 端(vue+ssr+egg)</h2><a id="more"></a>
<h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><h3 id="nuxt-安装"><a href="#nuxt-安装" class="headerlink" title="nuxt 安装"></a>nuxt 安装</h3><p><code>npx create-nuxt-app &lt;projectName&gt;</code> or <code>yarn create nuxt-app &lt;projectName&gt;</code></p>
<h3 id="nuxt-启动"><a href="#nuxt-启动" class="headerlink" title="nuxt 启动"></a>nuxt 启动</h3><p>为了使 node 文件支持 es6 语法和 async，await，需要使用 babel 配置一下。<br><code>npm i babel-cli -g</code>，然后在 package.json 里面的 dev 和 start 命令的最后面加上<code>--exec babel-node</code>,根目录新建一个<code>.babelrc</code>文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"stage-0"</span>],</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"transform-runtime"</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为安装的 eslint-plugin-vue 这个 eslint 校验规则是能自闭和的元素就自闭和，我个人不习惯，所以要重新设置一下<code>.eslintrc.js</code>,rules 里面添加上这段代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'vue/html-self-closing'</span>: [<span class="string">"error"</span>, &#123;</span><br><span class="line">  <span class="string">"html"</span>: &#123;</span><br><span class="line">    <span class="string">"void"</span>: <span class="string">"never"</span>,</span><br><span class="line">    <span class="string">"normal"</span>: <span class="string">"any"</span>,</span><br><span class="line">    <span class="string">"component"</span>: <span class="string">"any"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"svg"</span>: <span class="string">"always"</span>,</span><br><span class="line">  <span class="string">"math"</span>: <span class="string">"always"</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>安装<code>npm i babel-preset-es2015 babel-plugin-transform-runtime babel-runtime -D</code>，然后就可以执行<code>npm run dev</code>了。</p>
<h3 id="安装-redis"><a href="#安装-redis" class="headerlink" title="安装 redis"></a>安装 redis</h3><p>运行<code>brew install redis</code>安装。<br>Linux：cd 到 redis 的 src 目录 <code>./redis-server &amp;</code>(添加&amp;后台启动) or <code>./redis-server &amp; ../redis.conf</code>(配置文件启动)<br>运行<code>brew services start redis</code>后台运行 redis 服务，运行<code>brew services sop redis</code>停止后台服务。<br><code>redis-server</code>服务端运行命令,<code>redis-cli</code>运行客户端。<code>quit</code>退出服务端。</p>
<h3 id="nrm"><a href="#nrm" class="headerlink" title="nrm"></a>nrm</h3><p><code>npm install -g nrm</code> 一个能切换仓库源的工具。<br><code>nrm ls</code>列出仓库源。<br><code>nrm use ***</code>使用源。</p>
<h3 id="mongoDB"><a href="#mongoDB" class="headerlink" title="mongoDB"></a>mongoDB</h3><p>在数据文件目录使用命令导入数据表 <code>mongoimport -d meituan -c areas areas.dat</code> meituan 是数据库名字 areas 是集合(表名) areas.dat 是数据文件。<br><a href="https://segmentfault.com/a/1190000006236494" target="_blank" rel="noopener">导出导入操作集合</a></p>
<h3 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h3><p><code>curl -d &quot;name=lily&quot; http://*****</code>一个 linux 命令，发送 post 请求。<br>如果发送 get 请求则不用加-d。</p>
<h2 id="项目中遇到的问题"><a href="#项目中遇到的问题" class="headerlink" title="项目中遇到的问题"></a>项目中遇到的问题</h2><h3 id="让-node-支持-es6-导入语法"><a href="#让-node-支持-es6-导入语法" class="headerlink" title="让 node 支持 es6 导入语法"></a>让 node 支持 es6 导入语法</h3><ol>
<li><code>npm i babel-cli babel-preset-es2015 --save</code></li>
<li><p>根目录新建一个文件.babelrc 内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"presets"</span>: [<span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>package.json 的 script 启动项里面命令行最后面添加<code>--exec babel-node</code></p>
</li>
</ol>
<h3 id="组件引入-css"><a href="#组件引入-css" class="headerlink" title="组件引入 css"></a>组件引入 css</h3><p>如果使用 sass、less、stylus 一般平时可以使用<code>@/alias</code>的方式引入样式表，但是新版 nuxt 已经不支持如此引入方式。</p>
<blockquote>
<p>请注意: 从 Nuxt 2.0 开始，〜/alias 将无法在 CSS 文件中正确解析。你必须在 url CSS 引用中使用~assets（没有斜杠）或@别名，即 background:url(“~assets/banner.svg”)</p>
</blockquote>
<p>不过实际测试@不好使..<br>或者使用<code>styleResources</code>来处理样式的变量和<code>mixin</code>。<br><code>yarn add @nuxtjs/style-resources</code> &amp;&amp; <code>yarn add stylus-loader stylus</code>,<code>nuxt.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  modules: [<span class="string">"@nuxtjs/style-resources"</span>],</span><br><span class="line">  styleResources: &#123;</span><br><span class="line">    scss: <span class="string">"./assets/variables.scss"</span>,</span><br><span class="line">    less: <span class="string">"./assets/**/*.less"</span></span><br><span class="line">    <span class="comment">// sass: ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样就能随处使用定义过的变量或者函数…</p>
<h3 id="axios-封装及报错"><a href="#axios-封装及报错" class="headerlink" title="axios 封装及报错"></a>axios 封装及报错</h3><p>axios 报错<code>Cannot read property &#39;cancelToken&#39; of undefined</code>，原因是因为 request 拦截没有 <code>return config</code>。<br>优雅的切换 baseUrl,由于这个项目的登录接口在本地做了一次转发，因此在登录的时候请求的是本地的接口，其他时候都是请求的 egg 接口，因此我们要根据情况适当的切换 baseUrl，但是由于前端项目对 axios 进行了一遍封装，因此简单的引入 axios 设置 baseUrl 是无效的，我们需要引入 request.js 里面的 request 对象，然后<code>request.defaults.baseURL = url.Api</code>设置 baseUrl，同理 token 也可以如此设置:<code>request.defaults.headers.Authorization = &#39;Bearer &#39; + res.token</code></p>
<h3 id="第三方模块全局引入"><a href="#第三方模块全局引入" class="headerlink" title="第三方模块全局引入"></a>第三方模块全局引入</h3><p>没有找到设置全局模块的 webpack 配置，不过 nuxt 的 plugin 使用说明里面提供了几种全局使用第三方模块的方式。例如将第三方模块注入 Vue 或者 ctx 实例，这样就能在客户端或者服务端使用该模块。<br>例子:<br><code>npm install good-storage --save</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugin/storage.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> storage <span class="keyword">from</span> <span class="string">"good-storage"</span>;</span><br><span class="line">Vue.prototype.$storage = storage;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nuxt.config.js</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'@/plugins/element-ui'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      src: <span class="string">'@/plugins/storage'</span>,</span><br><span class="line">      ssr: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
<p>使用：<code>this.$storage.set(key,value)</code></p>
<h3 id="页面字体图标引入"><a href="#页面字体图标引入" class="headerlink" title="页面字体图标引入"></a>页面字体图标引入</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"header"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"https://s0.meituan.net/bs/fe-web-meituan/076a786/font/header.woff?t=1501036445556"</span>)</span><br><span class="line">    <span class="built_in">format</span>(<span class="string">"woff"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"home-category-iconfont"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"https://s0.meituan.net/bs/fe-web-meituan/076a786/font/home-category-iconfont.woff?t=1503027869484"</span>)</span><br><span class="line">    <span class="built_in">format</span>(<span class="string">"woff"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"MFShangHei-Regular"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"https://s0.meituan.net/bs/fe-web-meituan/076a786/font/MFShangHei-Regular.woff?t=1503027869484"</span>)</span><br><span class="line">    <span class="built_in">format</span>(<span class="string">"woff"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"numbers"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">"https://s0.meituan.net/bs/fe-web-meituan/076a786/font/numbers.woff?t=1503027869484"</span>)</span><br><span class="line">    <span class="built_in">format</span>(<span class="string">"woff"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先引入对应的组件图标并重命名，然后</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.home-category-iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: home-category-iconfont <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">-webkit-font-smoothing</span>: antialiased;</span><br><span class="line">  <span class="attribute">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hc-icon-food</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"\e622"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>单独写一个字体图标对应的 css 文件，并且在需要用到字体图标的组件引入，每个图标有单独对应的 css 语句，需要去审查美团网并复制。</p>
<h2 id="页面组件开发"><a href="#页面组件开发" class="headerlink" title="页面组件开发"></a>页面组件开发</h2><p>使用<code>template</code>包裹代码块做<code>v-for</code>循环，不会产生多余的 dom 结构。<br>使用<code>crypto-js</code>模块进行密码加密。</p>
<ol>
<li><code>npm i -save crypto-js</code></li>
<li><code>let CryptoJS = require(&#39;crypto-js&#39;)</code></li>
<li><code>CryptoJS.MD5(***).toString()</code></li>
</ol>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>Nuxt 不支持组件获取异步数据，所以要么在 mounted 里面写(不支持 ssr)，要么在 store 的 index 的 nuxtServerInit 方法里面写，但是这样会延迟首屏渲染时间(猜的,这个方法阻塞)，要么在页面里面获取数据然后使用 prop 或者存到 vuex 里面,但是 Nuxt 只有页面是支持预渲染请求数据的，组件并不支持，因此若想获取并保存和渲染数据，需要在最一开始使用到次组件的页面获取该组件的数据。这里我选择存 vuex 里面。</p>
<h3 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h3><p>vuex 使用模块功能时注意是否设置命名空间，注意 state 里面多了一层嵌套数据。</p>
<h3 id="Nuxt-使用-vue-awesome-swiper-做轮播等设置"><a href="#Nuxt-使用-vue-awesome-swiper-做轮播等设置" class="headerlink" title="Nuxt 使用 vue-awesome-swiper 做轮播等设置"></a>Nuxt 使用 vue-awesome-swiper 做轮播等设置</h3><p>照一般的组件设置后，使用方式如下<br><a href="https://github.com/surmon-china/vue-awesome-swiper/blob/master/examples/nuxt-ssr-example/nuxt-ssr-example.vue?1548230334530" target="_blank" rel="noopener">使用方式</a><br>div 标签上面加<code>v-swiper</code>指令设置</p>
<h2 id="后台业务开发"><a href="#后台业务开发" class="headerlink" title="后台业务开发"></a>后台业务开发</h2><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>用户表的几个字段，例如手机号、邮箱、昵称等字段，除了手机号是唯一但不必需的，手机号必需，因为这几个字段要用来进行登录等操作。同时因为注册的时候只使用手机号进行注册，为了避免因为邮箱、昵称等字段重复引起的注册失败，所以美团自己给用户的昵称设置了一个乱码，邮箱置为空，待以后填写。</p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>mongoose 进行一个值多个字段的查询，用途是根据用户输入的一个值来进行手机号、邮箱、昵称的查询：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">await</span> ctx.model.User.find(&#123;</span><br><span class="line">  $or: [</span><br><span class="line">    &#123; <span class="attr">phoneNum</span>: <span class="built_in">parseInt</span>(ctx.request.body.username) &#125;,</span><br><span class="line">    &#123; <span class="attr">userName</span>: ctx.request.body.username &#125;,</span><br><span class="line">    &#123; <span class="attr">email</span>: ctx.request.body.username &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>大部分页面和接口并不是一定要登录才能看到的，因此状态校验需要单独写在那些页面里面，包括后台路由校验 token 也是同理。</p>
<h2 id="Nuxt-和-eggjs-的部署"><a href="#Nuxt-和-eggjs-的部署" class="headerlink" title="Nuxt 和 eggjs 的部署"></a>Nuxt 和 eggjs 的部署</h2><h3 id="部署-eggjs"><a href="#部署-eggjs" class="headerlink" title="部署 eggjs"></a>部署 eggjs</h3><ol>
<li>首先编译</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>emmm,这个项目新建的时候不该用 axios module，它将 axios 又处理了一下，跟平常的使用习惯有较大差别。<br>用 MongoDB 有点不大好，MongoDB 本身文档资料较少，初步上手问题较多。<br>Jokcy 老师说前后端分离开发约定的数据基本就是扯淡，后端会改，弄得前端很麻烦，建议前端定义自己的数据格式然后请求接口的时候做一层映射。</p>
<h2 id="☆☆☆☆☆-这个项目思想出了问题"><a href="#☆☆☆☆☆-这个项目思想出了问题" class="headerlink" title="☆☆☆☆☆ 这个项目思想出了问题"></a>☆☆☆☆☆ 这个项目思想出了问题</h2><p>nuxt 我选择 vue+koa 混合的方式创建项目，我的后端使用 eggjs 进行编写，然而我忽略了一个问题，那就是：这个项目本身是基于 koa(后端项目)做的前端 Vue 项目(前端占比大),前后端共用一个端口(cookie 不能跨域)，共用一套路由，一些身份校验、token 保存要使用 cookie 来做，但是 cookie 一般不能跨域，即 3000 的 nuxt 端口无法直接向 7001 的 eggjs 服务端口发送 cookie，这样用户的登录态的保存就是个问题。<br>不过幸运的是可以换其他的方式进行解决。</p>
<h3 id="Nuxt-前后端分离开发-前端刷新判断用户状态-nuxt-做接口转发"><a href="#Nuxt-前后端分离开发-前端刷新判断用户状态-nuxt-做接口转发" class="headerlink" title="Nuxt 前后端分离开发 前端刷新判断用户状态 nuxt 做接口转发"></a>Nuxt 前后端分离开发 前端刷新判断用户状态 nuxt 做接口转发</h3><p>由于采用前后端分离式开发，nuxt 项目刷新的时候会将 vuex 数据刷新掉，页面渲染之前又无法取得 localStorage 保存的本地值，如果采用等页面渲染完成时候，再获取本地值请求接口获得用户数据的方式不安全也不优雅。经过网上查找之后我选择如下文章采用的方式，使用创建的 nuxt 项目自带的 koa 进行一下请求转发，然后由 koa 设置 cookie，用 nuxtServerInit 函数进行状态判断。</p>
<p><a href="https://juejin.im/post/5a24df9ef265da43133cfb2e" target="_blank" rel="noopener">参考资料：Nuxt.js 服务端渲染实践，从开发到部署</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Xavier</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.xaviershi.com/2018/12/26/vue+ssr开发美团网PC版/">http://blog.xaviershi.com/2018/12/26/vue+ssr开发美团网PC版/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明来自 <a href="http://blog.xaviershi.com" target="_blank">XS's Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><elif theme.sharejs && theme.sharejs.enable><div class="social-share" data-disabled="diandian"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></elif></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/01/10/Git的使用/"><i class="fa fa-chevron-left">  </i><span>Git的使用</span></a></div><div class="next-post pull-right"><a href="/2018/12/25/造一个简单的UI轮子/"><span>造一个简单的UI轮子(Vue)</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = 'http://blog.xaviershi.com/2018/12/26/vue+ssr开发美团网PC版/';
  this.page.identifier = '2018/12/26/vue+ssr开发美团网PC版/';
  this.page.title = 'vue+ssr开发美团网PC版';
}
var d = document, s = d.createElement('script');
s.src = "https://firstaurorablog.disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="https://firstaurorablog.disqus.com/count.js" async></script><elif theme.laibili && theme.laibili.enable></elif><elif theme.gitment && theme.gitment.enable></elif></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Xavier</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.4.1"></script><script src="/js/fancybox.js?version=1.4.1"></script><script src="/js/sidebar.js?version=1.4.1"></script><script src="/js/copy.js?version=1.4.1"></script><script src="/js/fireworks.js?version=1.4.1"></script><script src="/js/transition.js?version=1.4.1"></script><script src="/js/scroll.js?version=1.4.1"></script><script src="/js/head.js?version=1.4.1"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":250},"mobile":{"show":false},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body></html>